{% assign languages = site.data.languages %}

<div class="language-switcher" data-current-lang="{{ page.lang }}">
    {% for lang_data in languages %}
        {% assign lang_code = lang_data[0] %}
        {% assign lang_info = lang_data[1] %}
        
        {% if lang_code != page.lang %}
            <a href="#" 
               data-lang="{{ lang_code }}" 
               class="lang-link"
               title="{{ lang_info.name }}">
                <span class="flag">{{ lang_info.flag }}</span>
                <span class="lang-name">{{ lang_info.name }}</span>
            </a>
        {% endif %}
    {% endfor %}
</div>

<script>
// 简单的路由替换实现
document.querySelectorAll('.language-switcher .lang-link').forEach(link => {
    link.addEventListener('click', function(e) {
        e.preventDefault();
        
        const targetLang = this.getAttribute('data-lang');
        const currentUrl = window.location.pathname;
        const currentLang = document.querySelector('.language-switcher').getAttribute('data-current-lang');
        
        // 简单替换：将 /en/ 或 /zh/ 替换为目标语言
        let newUrl = currentUrl.replace(`/${currentLang}/`, `/${targetLang}/`);
        
        // 如果没有语言前缀（主页情况），加上目标语言
        if (newUrl === currentUrl) {
            newUrl = `/${targetLang}/`;
        }
        
        window.location.href = newUrl;
    });
});
</script>
